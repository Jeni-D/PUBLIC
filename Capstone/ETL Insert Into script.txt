-- IF RELOAD NEEDED
-- TRUNCATE TABLE CAPSTONE.JDUSCHAK.FACT_ACCIDENTS
-- TRUNCATE TABLE CAPSTONE.JDUSCHAK.DIM_ACCIDENT_TYPE
-- TRUNCATE TABLE CAPSTONE.JDUSCHAK.DIM_BODY_STYLE
-- TRUNCATE TABLE CAPSTONE.JDUSCHAK.DIM_GENDER_MARITAL
-- TRUNCATE TABLE CAPSTONE.JDUSCHAK.DIM_POLICYHOLDER
-- TRUNCATE TABLE CAPSTONE.JDUSCHAK.DIM_STATES
-- TRUNCATE TABLE CAPSTONE.JDUSCHAK.DIM_VEHICLE_USE


INSERT INTO CAPSTONE.JDUSCHAK.FACT_ACCIDENTS
(
SELECT
	a.ACCIDENT_ID as ACCIDENT_ID,
	a.POLICYHOLDER_ID as POLICYHOLDER_ID,
	a.VEHICLE_ID as VEHICLE_ID,
	p.STATE_CODE as STATE_ID,
	v.BODY_STYLE_CODE as BODY_STYLE_ID,
	a.ACCIDENT_TYPE as ACCIDENT_TYPE_ID,
	p.GENDER_MARITAL_STATUS as GENDER_MARITALSTATUS_ID,
	vu.USE_CODE as VEHICLE_USECODE_ID,
	a.ACCIDENT_DATE as ACCIDENT_DATE,
	v.YEAR as VEHICLE_YEAR,
	p.BIRTHDATE as POLICYHOLDER_BIRTHDATE,
	a.ESTIMATED_COST as ESTIMATED_COST,
	a.ACTUAL_REPAIR_COST as ACTUAL_REPAIR_COST,
	a.AT_FAULT as AT_FAULT,
	a.DUI as IS_DUI,
	i.COVERAGE_STATUS as COVERAGE_STATUS  
FROM 
    INSURANCE.CLAIMS.INSURANCE_COVERAGE as i
	JOIN INSURANCE.CLAIMS.POLICYHOLDER as p
	ON i.POLICYHOLDER_ID = p.POLICYHOLDER_ID
	JOIN INSURANCE.CLAIMS.ACCIDENTS as a 
	ON p.POLICYHOLDER_ID = a.POLICYHOLDER_ID
	JOIN INSURANCE.CLAIMS.VEHICLES as v 
	ON a.VEHICLE_ID = v.VEHICLE_ID
	JOIN INSURANCE.CLAIMS.VEHICLE_USE as vu 
	ON v.VEHICLE_ID = vu.VEHICLE_ID
);


INSERT INTO CAPSTONE.JDUSCHAK.DIM_ACCIDENT_TYPE
(
SELECT
	ACCIDENT_TYPE_CODE as ACCIDENT_TYPE_ID ,
	ACCIDENT_TYPE as ACCIDENT_TYPE
FROM
	INSURANCE.CLAIMS.ACCIDENT_TYPE	
);



INSERT INTO CAPSTONE.JDUSCHAK.DIM_BODY_STYLE
(
SELECT
	BODY_STYLE_CODE as BODY_STYLE_ID,
	BODY_STYLE as BODY_STYLE
FROM
	INSURANCE.CLAIMS.BODY_STYLE
);



INSERT INTO CAPSTONE.JDUSCHAK.DIM_GENDER_MARITAL
(
SELECT
	GENDER_MARITAL_STATUS_CODE as GENDER_MARITALSTATUS_ID, 
	GENDER_MARITAL_STATUS as GENDER_MARITAL_STATUS 
FROM
	INSURANCE.CLAIMS.GENDER_MARITAL_STATUS
);



INSERT INTO CAPSTONE.JDUSCHAK.DIM_POLICYHOLDER
(
SELECT
	POLICYHOLDER_ID as POLICYHOLDER_ID,
	FIRST_NAME as FIRST_NAME,
	LAST_NAME as LAST_NAME,
	ADDRESS as ADDRESS
FROM
	INSURANCE.CLAIMS.POLICYHOLDER
);


INSERT INTO CAPSTONE.JDUSCHAK.DIM_STATES
(
SELECT
	STATE_CODE as STATE_ID,
	STATE as STATE
FROM
	INSURANCE.CLAIMS.STATES
);


INSERT INTO CAPSTONE.JDUSCHAK.DIM_VEHICLE_USE
(
SELECT
	VEHICLE_USE_CODE as VEHICLE_USECODE_ID,
	VEHICLE_USE as VEHICLE_USE
FROM
	INSURANCE.CLAIMS.VEHICLE_USE_CODE
);